#!/usr/bin/python2.3
#
# autotest <control file> - run the autotest control file specified.
#
import os, sys, shutil
import job, kernel, test
from error import *
from autotest_utils import *

# Use the name of the binary to find the real installation directory
# aka $AUTODIR.  Update our path to include the $AUTODIR/bin/tests
# directory and ensure we have $AUTODIR in our environment.
autodirbin = os.path.abspath(os.path.dirname(sys.argv[0]))
autodir = os.path.dirname(autodirbin)

##print 'AUTODIRBIN: ' + autodirbin
##print 'AUTODIR: ' + autodir

sys.path.insert(0, autodir + '/tests')
sys.path.insert(0, autodirbin)

os.environ['AUTODIR'] = autodir
os.environ['AUTODIRBIN'] = autodirbin
os.environ['PYTHONPATH'] = autodirbin

def usage():
	os.stderr.write("Usage: autotest [--continue] <control file>\n");
	sys.exit(1)

# Usage check.
if len(sys.argv) < 2:
	usage()

# A multi-phase job is continued using the --continue option.
cont = 0
if sys.argv[1] == '--continue':
	sys.argv.pop(1)
	cont = 1
	
# Check for a control file.
if len(sys.argv) != 2:
	usage()

# JOB: run the specified job control file.
job.runjob(sys.argv[1], cont)
